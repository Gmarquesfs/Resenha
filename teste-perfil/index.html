<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avaliação de Perfil Comportamental</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .question-card { transition: all 0.3s ease; }
    .question-card.error { border-color: #ef4444; }
  </style>
</head>
<body class="bg-gray-50 py-10">
  <div class="max-w-3xl mx-auto bg-white rounded-xl shadow-xl px-6 py-8">
    <h1 class="text-3xl font-bold text-center text-purple-600 mb-2">Avaliação de Perfil Comportamental</h1>
    <p class="text-gray-600 text-center mb-6">Responda com atenção para descobrir seu perfil.</p>

    <form id="quizForm">
      <div id="form-inicial" class="space-y-4">
        <input type="text" name="nome" placeholder="Nome" required class="w-full border rounded-md p-3 border-gray-300">
        <input type="email" name="email" placeholder="E-mail" required class="w-full border rounded-md p-3 border-gray-300">
        <input type="tel" name="telefone" placeholder="Telefone" required class="w-full border rounded-md p-3 border-gray-300">
        <input type="text" name="empresa" placeholder="Empresa" required class="w-full border rounded-md p-3 border-gray-300">
        <button type="button" id="btn-start" class="mt-4 w-full bg-purple-600 text-white py-2 rounded-md hover:bg-purple-700 transition">Começar</button>
      </div>

      <div id="quiz-container" class="hidden">
        <div id="questions-container" class="space-y-6"></div>
        <div class="flex justify-between mt-6">
          <button type="button" id="prev-btn" class="bg-gray-300 text-gray-700 py-2 px-4 rounded-md hidden">Anterior</button>
          <button type="button" id="next-btn" class="ml-auto bg-purple-600 text-white py-2 px-4 rounded-md">Próximo</button>
          <button type="submit" id="submit-btn" class="ml-auto bg-green-600 text-white py-2 px-4 rounded-md hidden">Finalizar</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    const perguntas = ["Eu sou...", "Eu gosto de...", "Se quiser se dar bem comigo...", "Para obter bons resultados é preciso...", "Eu me divirto quando...",
      "Eu penso que...", "Minha preocupação é...", "Eu prefiro...", "Eu gosto de...", "Eu gosto de chegar...", "Um ótimo dia é quando...", "Vejo a morte como...",
      "Minha filosofia é...", "Sempre gostei de...", "Mudanças são boas se...", "Nada de errado em...", "Busco conselhos de...", "Meu lema é...", "Eu gosto de...",
      "Tempo é...", "Se bilionário...", "Eu acredito que...", "Acredito também...", "Ainda acredito que...", "Eu penso que..."];

    const opcoes = ["I", "C", "O", "A"];
    const perfilMap = { I: 'i', C: 'c', O: 'o', A: 'a' };

    let currentPage = 0;

    const btnStart = document.getElementById("btn-start");
    const formInicial = document.getElementById("form-inicial");
    const quizContainer = document.getElementById("quiz-container");
    const questionsContainer = document.getElementById("questions-container");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const submitBtn = document.getElementById("submit-btn");

    btnStart.onclick = () => {
      formInicial.classList.add("hidden");
      quizContainer.classList.remove("hidden");
      renderQuestions();
    };

    function renderQuestions() {
      questionsContainer.innerHTML = "";
      const start = currentPage * 5;
      const end = start + 5;

      perguntas.slice(start, end).forEach((pergunta, i) => {
        const card = document.createElement("div");
        card.className = "question-card border border-gray-200 rounded-xl p-4";
        card.innerHTML = `<h3 class="mb-2 font-semibold text-purple-600">${start + i + 1}. ${pergunta}</h3>`;
        opcoes.forEach(op => {
          card.innerHTML += `<label class="block"><input type="radio" name="q${start + i}" value="${perfilMap[op]}"> ${op}</label>`;
        });
        questionsContainer.appendChild(card);
      });

      prevBtn.classList.toggle("hidden", currentPage === 0);
      nextBtn.classList.toggle("hidden", end >= perguntas.length);
      submitBtn.classList.toggle("hidden", end < perguntas.length);
    }

    function checkAnswers() {
      let valid = true;
      document.querySelectorAll('.question-card').forEach(card => {
        card.classList.remove("error");
        if (!card.querySelector('input[type="radio"]:checked')) {
          card.classList.add("error");
          valid = false;
        }
      });
      return valid;
    }

    nextBtn.onclick = () => {
      if (checkAnswers()) { currentPage++; renderQuestions(); }
    };

    prevBtn.onclick = () => { currentPage--; renderQuestions(); };

    document.getElementById('quizForm').onsubmit = (e) => {
      e.preventDefault();
      if (!checkAnswers()) return;

      const data = new FormData(e.target);
      const result = { i:0, c:0, o:0, a:0 };
      for (let [key, value] of data.entries()) {
        if (result[value] !== undefined) result[value]++;
      }

      const percentuais = {};
      Object.keys(result).forEach(k => percentuais[k] = result[k] * 4);

      const perfilDominante = Object.keys(result).reduce((a, b) => result[a] > result[b] ? a : b);

      const nome = data.get("nome");
      const query = new URLSearchParams({ perfil: perfilDominante, ...percentuais, nome }).toString();

      window.location.href = "resultado.html?" + query;
    };
  </script>
</body>
</html>
